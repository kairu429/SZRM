<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µã‚¤ã‚¼ãƒªãƒ¤æ³¨æ–‡ã‚¹ãƒ­ãƒƒãƒˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@700&display=swap');
        
        body {
            font-family: 'M PLUS Rounded 1c', sans-serif;
            background-color: #f3f4f6;
            overflow-x: hidden;
        }

        .slot-card {
            background: white;
            border: 8px solid #009241; /* ã‚µã‚¤ã‚¼ãƒªãƒ¤ã‚°ãƒªãƒ¼ãƒ³ */
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .slot-window {
            height: 120px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff;
            border: 4px inset #eee;
            margin: 10px 0;
        }

        .spinning {
            animation: slot-spin 0.1s linear infinite;
        }

        @keyframes slot-spin {
            0% { transform: translateY(-10px); opacity: 0.5; }
            50% { transform: translateY(10px); opacity: 0.8; }
            100% { transform: translateY(-10px); opacity: 0.5; }
        }

        .saize-red { color: #e4002b; }
        .saize-green { color: #009241; }
        .btn-gradient {
            background: linear-gradient(to bottom, #009241, #007a37);
            transition: transform 0.1s;
        }
        .btn-gradient:active {
            transform: scale(0.95);
        }

        #collection-modal, #age-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 50;
        }
        .modal-content {
            max-height: 70vh;
            overflow-y: auto;
        }

        .tab-active {
            border-bottom: 4px solid white;
            opacity: 1;
        }
        .tab-inactive {
            opacity: 0.6;
        }

        .trophy-card {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border: 2px solid #e5e7eb;
        }
        .trophy-unlocked {
            border-color: #fbbf24;
            background: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
        }

        @keyframes rainbow {
            0% { color: #ff0000; }
            17% { color: #ff8800; }
            33% { color: #ffff00; }
            50% { color: #00ff00; }
            67% { color: #0000ff; }
            83% { color: #8800ff; }
            100% { color: #ff0000; }
        }
        .rainbow-text {
            animation: rainbow 3s linear infinite;
        }

        #trophy-notification {
            position: fixed;
            top: 20px;
            right: -300px;
            width: 280px;
            background: white;
            border-left: 6px solid #fbbf24;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            border-radius: 8px;
            transition: right 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 100;
        }
        #trophy-notification.show {
            right: 20px;
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <!-- ãƒˆãƒ­ãƒ•ã‚£ãƒ¼é€šçŸ¥ -->
    <div id="trophy-notification" class="flex items-center p-4">
        <div class="text-3xl mr-3" id="notify-icon">ğŸ†</div>
        <div>
            <div class="text-xs font-bold text-yellow-600">ğŸ† å®Ÿç¸¾è§£é™¤ï¼</div>
            <div class="text-sm font-bold text-gray-800" id="notify-title"></div>
        </div>
    </div>

    <div class="max-w-md w-full text-center">
        <h1 class="text-3xl mb-6 saize-red">
            <span class="bg-white px-4 py-1 rounded-full border-2 border-green-600">ã‚µã‚¤ã‚¼ãƒªãƒ¤ æ³¨æ–‡ã‚¬ãƒãƒ£</span>
        </h1>

        <div class="slot-card p-6 mb-8 relative">
            <div id="king-badge" class="hidden absolute -top-4 -right-4 bg-yellow-400 text-white text-xs font-bold px-3 py-1 rounded-full shadow-lg border-2 border-white animate-bounce">
                ğŸ‘‘ ç‹æ§˜ã®ç‰¹æ¨©ç™ºå‹•ä¸­
            </div>
            <div class="flex justify-between items-center mb-2">
                <div class="text-gray-500 text-sm" id="category-label">ã‚«ãƒ†ã‚´ãƒª</div>
                <button id="open-settings" class="text-xs bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded text-gray-600">âš™ï¸ å¹´é½¢è¨­å®š</button>
            </div>
            
            <div class="slot-window rounded-lg">
                <div id="menu-name" class="text-2xl font-bold px-4 text-center">ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</div>
            </div>

            <div class="flex justify-between items-center mt-4 px-2">
                <div class="text-lg font-bold saize-green" id="menu-id">â„– ----</div>
                <div class="text-2xl font-bold saize-red" id="menu-price">Â¥ ---</div>
            </div>
        </div>

        <button id="spin-btn" class="btn-gradient text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg w-full mb-4">
            æ³¨æ–‡ã‚’æ±ºã‚ã‚‹ï¼
        </button>

        <p class="text-xs text-gray-400 mt-4">
            â€»ä¾¡æ ¼ã¯ç¨è¾¼ã¿ãƒ»å…¨å›½ç‰ˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’åŸºæº–ã¨ã—ã¦ã„ã¾ã™ã€‚
        </p>
    </div>

    <!-- å¹´é½¢è¨­å®šãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="age-modal" class="flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-xs w-full text-center">
            <div class="text-4xl mb-4">ğŸ‚</div>
            <h2 class="text-xl font-bold mb-4">å¹´é½¢ã‚’æ•™ãˆã¦ãã ã•ã„</h2>
            <p class="text-sm text-gray-500 mb-6">20æ­³æœªæº€ã®æ–¹ã¯ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé™¤å¤–ã•ã‚Œã¾ã™ã€‚</p>
            <input type="number" id="age-input" class="w-full border-2 border-gray-300 rounded-xl p-3 mb-6 text-center text-xl font-bold focus:border-green-500 outline-none" placeholder="ä¾‹: 20">
            <button id="save-age-btn" class="w-full bg-green-600 text-white font-bold py-3 rounded-xl hover:bg-green-700">è¨­å®šã™ã‚‹</button>
        </div>
    </div>

    <!-- å›³é‘‘è¡¨ç¤ºãƒœã‚¿ãƒ³ -->
    <button id="open-collection" class="fixed bottom-6 right-6 w-16 h-16 bg-white border-4 border-green-600 rounded-full shadow-xl flex items-center justify-center text-3xl hover:bg-green-50 transition-colors z-40">
        ğŸ“–
    </button>

    <!-- å›³é‘‘/ãƒˆãƒ­ãƒ•ã‚£ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="collection-modal" class="flex items-center justify-center p-4">
        <div class="bg-white w-full max-w-lg rounded-3xl overflow-hidden shadow-2xl flex flex-col">
            <div class="bg-green-600 p-2">
                <div class="flex justify-around text-white font-bold">
                    <button id="tab-menu" class="py-2 px-4 tab-active">å›³é‘‘</button>
                    <button id="tab-trophy" class="py-2 px-4 tab-inactive">ãƒˆãƒ­ãƒ•ã‚£ãƒ¼</button>
                    <button id="close-modal" class="py-2 px-4 text-2xl">&times;</button>
                </div>
            </div>

            <div id="section-menu">
                <div class="p-4 bg-gray-100 border-b flex justify-between items-center">
                    <span id="collection-count" class="text-sm font-bold text-gray-600">é”æˆç‡: 0 / 0 (0%)</span>
                    <div class="w-1/2 bg-gray-300 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-green-500 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                <div class="modal-content p-4 grid grid-cols-1 gap-2" id="collection-list"></div>
            </div>

            <div id="section-trophy" class="hidden">
                <div class="p-4 bg-yellow-50 border-b">
                    <p class="text-xs text-yellow-700 font-bold text-center">ğŸ† å®Ÿç¸¾ã‚’è§£é™¤ã—ã¦ç‰¹åˆ¥ãªç§°å·ã‚’æ‰‹ã«å…¥ã‚Œã‚ˆã† ğŸ†</p>
                </div>
                <div class="modal-content p-4 space-y-3" id="trophy-list"></div>
            </div>
        </div>
    </div>

    <script>
        const menuData = [
            { id: "1202", name: "å°ã‚¨ãƒ“ã®ã‚µãƒ©ãƒ€", price: 350, cat: "ã‚µãƒ©ãƒ€" },
            { id: "1205", name: "ã‚ã‹ã‚ã®ã‚µãƒ©ãƒ€", price: 350, cat: "ã‚µãƒ©ãƒ€" },
            { id: "1207", name: "ãƒ¢ãƒƒãƒ„ã‚¡ãƒ¬ãƒ©ã®ã‚µãƒ©ãƒ€", price: 400, cat: "ã‚µãƒ©ãƒ€" },
            { id: "1208", name: "ã‚°ãƒªãƒ¼ãƒ³ã‚µãƒ©ãƒ€", price: 350, cat: "ã‚µãƒ©ãƒ€" },
            { id: "1209", name: "ãƒã‚­ãƒ³ã®ã‚µãƒ©ãƒ€", price: 350, cat: "ã‚µãƒ©ãƒ€" },
            { id: "1301", name: "ã‚³ãƒ¼ãƒ³ã‚¯ãƒªãƒ¼ãƒ ã‚¹ãƒ¼ãƒ—", price: 150, cat: "ã‚¹ãƒ¼ãƒ—" },
            { id: "1305", name: "ç”°èˆé¢¨ãƒŸãƒã‚¹ãƒˆãƒ­ãƒ¼ãƒ", price: 300, cat: "ã‚¹ãƒ¼ãƒ—" },
            { id: "1307", name: "ãŸã¾ã­ãã®ã‚ºãƒƒãƒ‘", price: 300, cat: "ã‚¹ãƒ¼ãƒ—" },
            { id: "1401", name: "è¾›å‘³ãƒã‚­ãƒ³", price: 300, cat: "å‰èœ" },
            { id: "1402", name: "ã‚¢ãƒ­ã‚¹ãƒ†ã‚£ãƒãƒ¼ãƒ‹", price: 400, cat: "å‰èœ" },
            { id: "1403", name: "ã»ã†ã‚Œã‚“è‰ã®ã‚½ãƒ†ãƒ¼", price: 200, cat: "å‰èœ" },
            { id: "1404", name: "ãƒãƒƒãƒ—ã‚³ãƒ¼ãƒ³ã‚·ãƒ¥ãƒªãƒ³ãƒ—", price: 300, cat: "å‰èœ" },
            { id: "1405", name: "ã‚¨ã‚¹ã‚«ãƒ«ã‚´ã®ã‚ªãƒ¼ãƒ–ãƒ³ç„¼ã", price: 400, cat: "å‰èœ" },
            { id: "1406", name: "å°ã‚¨ãƒ“ã®ã‚«ã‚¯ãƒ†ãƒ«", price: 280, cat: "å‰èœ" },
            { id: "1407", name: "ãƒãƒ§ãƒªã‚½ãƒ¼", price: 400, cat: "å‰èœ" },
            { id: "1413", name: "çˆ½ã‚„ã‹ã«ã‚“ã˜ã‚“ã‚µãƒ©ãƒ€", price: 200, cat: "å‰èœ" },
            { id: "1415", name: "ã‚«ãƒªãƒƒã¨ãƒãƒ†ãƒˆ", price: 250, cat: "å‰èœ" },
            { id: "1422", name: "ãƒãƒ¢ãƒ³ãƒ»ã‚»ãƒ©ãƒ¼ãƒ", price: 320, cat: "å‰èœ" },
            { id: "1425", name: "æŸ”ã‚‰ã‹é’è±†ã®æ¸©ã‚µãƒ©ãƒ€", price: 200, cat: "å‰èœ" },
            { id: "2101", name: "ãƒŸãƒ©ãƒé¢¨ãƒ‰ãƒªã‚¢", price: 300, cat: "ãƒ‰ãƒªã‚¢" },
            { id: "2103", name: "åŠç†Ÿåµã®ãƒŸãƒ©ãƒé¢¨ãƒ‰ãƒªã‚¢", price: 350, cat: "ãƒ‰ãƒªã‚¢" },
            { id: "2106", name: "ã‚¿ãƒ©ã‚³ã¨ã‚¨ãƒ“ã®ãƒ‰ãƒªã‚¢", price: 400, cat: "ãƒ‰ãƒªã‚¢" },
            { id: "2203", name: "ãƒãƒ«ã‚²ãƒªãƒ¼ã‚¿ãƒ”ã‚¶", price: 400, cat: "ãƒ”ã‚¶" },
            { id: "2206", name: "ãŸã£ã·ã‚Šã‚³ãƒ¼ãƒ³ã®ãƒ”ã‚¶", price: 400, cat: "ãƒ”ã‚¶" },
            { id: "2208", name: "ã‚½ãƒ¼ã‚»ãƒ¼ã‚¸ãƒ”ã‚¶", price: 450, cat: "ãƒ”ã‚¶" },
            { id: "2301", name: "ã‚¿ãƒ©ã‚³ã‚½ãƒ¼ã‚¹ã‚·ã‚·ãƒªãƒ¼é¢¨", price: 400, cat: "ãƒ‘ã‚¹ã‚¿" },
            { id: "2303", name: "ãƒšãƒšãƒ­ãƒ³ãƒãƒ¼ãƒ", price: 300, cat: "ãƒ‘ã‚¹ã‚¿" },
            { id: "2305", name: "ã‚«ãƒ«ãƒœãƒŠãƒ¼ãƒ©", price: 500, cat: "ãƒ‘ã‚¹ã‚¿" },
            { id: "2308", name: "ãƒ‘ãƒ«ãƒé¢¨ã‚¹ãƒ‘ã‚²ãƒƒãƒ†ã‚£", price: 400, cat: "ãƒ‘ã‚¹ã‚¿" },
            { id: "2328", name: "ã‚¤ã‚«ã®å¢¨å…¥ã‚Šã‚»ãƒ”ã‚¢ã‚½ãƒ¼ã‚¹", price: 500, cat: "ãƒ‘ã‚¹ã‚¿" },
            { id: "2402", name: "è‹¥é¶ã®ãƒ‡ã‚£ã‚¢ãƒœãƒ©é¢¨", price: 500, cat: "è‚‰æ–™ç†" },
            { id: "2403", name: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒãƒ³ãƒãƒ¼ã‚°", price: 500, cat: "è‚‰æ–™ç†" },
            { id: "2418", name: "ãƒŸãƒƒã‚¯ã‚¹ã‚°ãƒªãƒ«", price: 650, cat: "è‚‰æ–™ç†" },
            { id: "2420", name: "ãƒ©ãƒ ã®ã‚¹ãƒ†ãƒ¼ã‚­", price: 800, cat: "è‚‰æ–™ç†" },
            { id: "3201", name: "ãƒ†ã‚£ãƒ©ãƒŸã‚¹ã‚¯ãƒ©ã‚·ã‚³", price: 300, cat: "ãƒ‡ã‚¶ãƒ¼ãƒˆ" },
            { id: "3206", name: "ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒ—ãƒªãƒ³", price: 250, cat: "ãƒ‡ã‚¶ãƒ¼ãƒˆ" },
            { id: "3215", name: "ã‚³ãƒ¼ãƒ’ãƒ¼ã‚¼ãƒªãƒ¼ï¼†ã‚¸ã‚§ãƒ©ãƒ¼ãƒˆ", price: 350, cat: "ãƒ‡ã‚¶ãƒ¼ãƒˆ" },
            { id: "3218", name: "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚±ãƒ¼ã‚­", price: 300, cat: "ãƒ‡ã‚¶ãƒ¼ãƒˆ" },
            { id: "3301", name: "ç”Ÿãƒ“ãƒ¼ãƒ«ã‚¸ãƒ§ãƒƒã‚­", price: 400, cat: "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«" },
            { id: "3401", name: "ã‚°ãƒ©ã‚¹ãƒ¯ã‚¤ãƒ³èµ¤", price: 100, cat: "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«" },
            { id: "5101", name: "ã‚»ãƒƒãƒˆãƒ‰ãƒªãƒ³ã‚¯ãƒãƒ¼", price: 200, cat: "ãƒ‰ãƒªãƒ³ã‚¯ãƒãƒ¼" }
        ];

        // Cookieæ“ä½œ
        const setCookie = (name, value) => {
            const date = new Date();
            date.setTime(date.getTime() + (365 * 24 * 60 * 60 * 1000));
            document.cookie = `${name}=${encodeURIComponent(JSON.stringify(value))};expires=${date.toUTCString()};path=/`;
        };

        const getCookie = (name) => {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) {
                    try {
                        return JSON.parse(decodeURIComponent(c.substring(nameEQ.length, c.length)));
                    } catch (e) { return null; }
                }
            }
            return null;
        };

        // ã‚¹ãƒ†ãƒ¼ãƒˆç®¡ç†
        let state = {
            collected: getCookie('saize_collection') || [],
            totalSpins: getCookie('saize_spins') || 0,
            consecutiveDupes: getCookie('saize_dupes') || 0,
            hasSoup: getCookie('saize_has_soup') || false,
            hasAlcohol: getCookie('saize_has_alc') || false,
            carbCount: getCookie('saize_carb_count') || 0,
            dessertCount: getCookie('saize_dessert_count') || 0,
            saladCount: getCookie('saize_salad_count') || 0,
            unlockedTrophies: getCookie('saize_trophies') || [],
            age: getCookie('saize_age') || null,
            isKing: false
        };

        const spinBtn = document.getElementById('spin-btn');
        const menuNameDisp = document.getElementById('menu-name');
        const menuIdDisp = document.getElementById('menu-id');
        const menuPriceDisp = document.getElementById('menu-price');
        const catLabel = document.getElementById('category-label');
        const kingBadge = document.getElementById('king-badge');
        const notify = document.getElementById('trophy-notification');
        const ageModal = document.getElementById('age-modal');
        const ageInput = document.getElementById('age-input');
        const saveAgeBtn = document.getElementById('save-age-btn');

        // å¹´é½¢ç¢ºèªã®åˆæœŸå‡¦ç†
        if (state.age === null) {
            ageModal.style.display = 'flex';
        }

        saveAgeBtn.addEventListener('click', () => {
            const val = parseInt(ageInput.value);
            if (!val || val < 0) return;
            state.age = val;
            setCookie('saize_age', val);
            ageModal.style.display = 'none';
        });

        document.getElementById('open-settings').addEventListener('click', () => {
            ageInput.value = state.age;
            ageModal.style.display = 'flex';
        });

        function showTrophyNotify(title, icon = "ğŸ†") {
            document.getElementById('notify-title').innerText = title;
            document.getElementById('notify-icon').innerText = icon;
            notify.classList.add('show');
            setTimeout(() => notify.classList.remove('show'), 4000);
        }

        function checkTrophies(lastMenu = null) {
            const currentTrophies = [
                { id: "king", title: "ã•ã„ãœã‚Šã‚ã®ç‹æ§˜", cond: state.collected.length >= menuData.length, icon: "ğŸ‘‘" },
                { id: "soup", title: "ã‚¹ãƒ¼ãƒ—ã¯å¤§å¥½ç‰©ã§ã™!!!!", cond: state.hasSoup, icon: "ğŸ¥£" },
                { id: "dupe", title: "ã“ã®æµã‚Œã‚’æ­¢ã‚ã¦", cond: state.consecutiveDupes >= 10, icon: "â™»ï¸" },
                { id: "spins_10", title: "åˆè¨ˆ10å›å¼•ã", cond: state.totalSpins >= 10, icon: "â±ï¸" },
                { id: "alcohol", title: "ãƒ¯ã‚¤ãƒ³ã®é”äºº", cond: state.hasAlcohol, icon: "ğŸ·" },
                { id: "carbs", title: "ç‚­æ°´åŒ–ç‰©ã®é¬¼", cond: state.carbCount >= 10, icon: "ğŸ" },
                { id: "rich", title: "å¤§å¯Œè±ª", cond: lastMenu && lastMenu.price >= 500, icon: "ğŸ’°" },
                { id: "onecoin", title: "ãƒ¯ãƒ³ã‚³ã‚¤ãƒ³ã®å¹¸ã›", cond: lastMenu && lastMenu.price === 500, icon: "ğŸª™" },
                { id: "milano", title: "ãƒŸãƒ©ãƒé¢¨ã®ä¼é“å¸«", cond: lastMenu && lastMenu.name.includes("ãƒŸãƒ©ãƒé¢¨"), icon: "ğŸ›" },
                { id: "dessert_lover", title: "ãƒ‡ã‚¶ãƒ¼ãƒˆã¯åˆ¥è…¹", cond: state.dessertCount >= 3, icon: "ğŸ°" },
                { id: "vegetarian", title: "ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³", cond: state.saladCount >= 3, icon: "ğŸ¥—" },
                { id: "senbero", title: "ã›ã‚“ã¹ã‚", cond: lastMenu && lastMenu.price === 100, icon: "ğŸ’¸" },
                { id: "junkie", title: "ã‚¬ãƒãƒ£ã‚¸ãƒ£ãƒ³ã‚­ãƒ¼", cond: state.totalSpins >= 30, icon: "ğŸ°" }
            ];

            currentTrophies.forEach(t => {
                if (t.cond && !state.unlockedTrophies.includes(t.id)) {
                    state.unlockedTrophies.push(t.id);
                    setCookie('saize_trophies', state.unlockedTrophies);
                    showTrophyNotify(t.title, t.icon);
                }
            });

            state.isKing = state.collected.length === menuData.length;
            if (state.isKing) kingBadge.classList.remove('hidden');
        }
        checkTrophies();

        function getFilteredMenu() {
            // å¹´é½¢åˆ¶é™ã®é©ç”¨
            if (state.age !== null && state.age < 20) {
                return menuData.filter(m => m.cat !== "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«");
            }
            return menuData;
        }

        function getRandomMenu() {
            const available = getFilteredMenu();
            if (state.isKing) {
                return available[Math.floor(Math.random() * available.length)];
            }
            const uncollected = available.filter(m => !state.collected.includes(m.id));
            if (uncollected.length > 0 && Math.random() < 0.15) { 
                return uncollected[Math.floor(Math.random() * uncollected.length)];
            }
            return available[Math.floor(Math.random() * available.length)];
        }

        function spin() {
            if (state.age === null) {
                ageModal.style.display = 'flex';
                return;
            }
            spinBtn.disabled = true;
            menuNameDisp.classList.add('spinning');
            let counter = 0;
            const available = getFilteredMenu();
            const interval = setInterval(() => {
                const m = available[Math.floor(Math.random() * available.length)];
                menuNameDisp.innerText = m.name;
                counter++;
                if (counter > 20) {
                    clearInterval(interval);
                    stopSpin();
                }
            }, 80);
        }

        function stopSpin() {
            const finalMenu = getRandomMenu();
            menuNameDisp.classList.remove('spinning');
            menuNameDisp.innerText = finalMenu.name;
            menuIdDisp.innerText = "â„– " + finalMenu.id;
            menuPriceDisp.innerText = "Â¥ " + finalMenu.price;
            catLabel.innerText = finalMenu.cat;

            state.totalSpins++;
            
            if (finalMenu.cat === "ã‚¹ãƒ¼ãƒ—") {
                state.hasSoup = true;
                setCookie('saize_has_soup', true);
            }
            if (finalMenu.cat === "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«") {
                state.hasAlcohol = true;
                setCookie('saize_has_alc', true);
            }
            if (finalMenu.cat === "ãƒ‘ã‚¹ã‚¿" || finalMenu.cat === "ãƒ”ã‚¶" || finalMenu.cat === "ãƒ‰ãƒªã‚¢") {
                state.carbCount++;
                setCookie('saize_carb_count', state.carbCount);
            }
            if (finalMenu.cat === "ãƒ‡ã‚¶ãƒ¼ãƒˆ") {
                state.dessertCount++;
                setCookie('saize_dessert_count', state.dessertCount);
            }
            if (finalMenu.cat === "ã‚µãƒ©ãƒ€") {
                state.saladCount++;
                setCookie('saize_salad_count', state.saladCount);
            }

            if (state.collected.includes(finalMenu.id)) {
                state.consecutiveDupes++;
            } else {
                state.collected.push(finalMenu.id);
                state.consecutiveDupes = 0;
            }

            setCookie('saize_collection', state.collected);
            setCookie('saize_spins', state.totalSpins);
            setCookie('saize_dupes', state.consecutiveDupes);
            
            checkTrophies(finalMenu);
            spinBtn.disabled = false;
        }

        function updateTabs(target) {
            const tabMenu = document.getElementById('tab-menu');
            const tabTrophy = document.getElementById('tab-trophy');
            const secMenu = document.getElementById('section-menu');
            const secTrophy = document.getElementById('section-trophy');

            if (target === 'menu') {
                secMenu.classList.remove('hidden');
                secTrophy.classList.add('hidden');
                tabMenu.className = 'py-2 px-4 tab-active';
                tabTrophy.className = 'py-2 px-4 tab-inactive';
                updateCollectionView();
            } else {
                secMenu.classList.add('hidden');
                secTrophy.classList.remove('hidden');
                tabMenu.className = 'py-2 px-4 tab-inactive';
                tabTrophy.className = 'py-2 px-4 tab-active';
                updateTrophyView();
            }
        }

        function updateCollectionView() {
            const list = document.getElementById('collection-list');
            list.innerHTML = '';
            
            const isMinor = state.age !== null && state.age < 20;
            const totalCount = isMinor ? menuData.filter(m => m.cat !== "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«").length : menuData.length;

            menuData.forEach(item => {
                // 20æ­³æœªæº€ã§ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å ´åˆã¯è¡¨ç¤ºã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆã¾ãŸã¯ãƒ­ãƒƒã‚¯ï¼‰
                const isAlc = item.cat === "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«";
                if (isMinor && isAlc) return; 

                const isCollected = state.collected.includes(item.id);
                const itemEl = document.createElement('div');
                itemEl.className = `p-3 rounded-xl border flex justify-between items-center ${isCollected ? 'bg-white' : 'bg-gray-100 opacity-50'}`;
                itemEl.innerHTML = `
                    <div>
                        <span class="text-xs font-bold ${isCollected ? 'text-green-600' : 'text-gray-400'}">â„–${item.id}</span>
                        <div class="text-sm font-bold text-gray-800">${isCollected ? item.name : 'ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ'}</div>
                    </div>
                    <div class="text-sm saize-red font-bold">${isCollected ? 'Â¥' + item.price : '---'}</div>
                `;
                list.appendChild(itemEl);
            });
            
            const collectedCount = isMinor ? state.collected.filter(id => {
                const m = menuData.find(menu => menu.id === id);
                return m && m.cat !== "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«";
            }).length : state.collected.length;

            const percent = Math.round((collectedCount / totalCount) * 100);
            document.getElementById('collection-count').innerText = `é”æˆç‡: ${collectedCount} / ${totalCount} (${percent}%)`;
            document.getElementById('progress-bar').style.width = `${percent}%`;
        }

        function updateTrophyView() {
            const list = document.getElementById('trophy-list');
            list.innerHTML = '';
            const isMinor = state.age !== null && state.age < 20;

            const trophies = [
                { id: "king", title: "ã•ã„ãœã‚Šã‚ã®ç‹æ§˜", sub: "ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ã™ã¹ã¦ã‚²ãƒƒãƒˆã™ã‚‹", icon: "ğŸ‘‘" },
                { id: "soup", title: "ã‚¹ãƒ¼ãƒ—ã¯å¤§å¥½ç‰©ã§ã™!!!!", sub: "ã‚¹ãƒ¼ãƒ—ç³»ã‚’å¼•ã", icon: "ğŸ¥£", isRainbow: true },
                { id: "rich", title: "å¤§å¯Œè±ª", sub: "500å††ä»¥ä¸Šã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¼•ã", icon: "ğŸ’°" },
                { id: "onecoin", title: "ãƒ¯ãƒ³ã‚³ã‚¤ãƒ³ã®å¹¸ã›", sub: "ã¡ã‚‡ã†ã©500å††ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¼•ã", icon: "ğŸª™" },
                { id: "carbs", title: "ç‚­æ°´åŒ–ç‰©ã®é¬¼", sub: "ãƒ‘ã‚¹ã‚¿/ãƒ”ã‚¶/ãƒ‰ãƒªã‚¢ã‚’åˆè¨ˆ10å›å¼•ã", icon: "ğŸ" },
                { id: "alcohol", title: "ãƒ¯ã‚¤ãƒ³ã®é”äºº", sub: "ã‚¢ãƒ«ã‚³ãƒ¼ãƒ«ç³»ã‚’å¼•ã", icon: "ğŸ·", hiddenIfMinor: true },
                { id: "milano", title: "ãƒŸãƒ©ãƒé¢¨ã®ä¼é“å¸«", sub: "ãƒŸãƒ©ãƒé¢¨ãƒ‰ãƒªã‚¢ã‚’å¼•ã", icon: "ğŸ›" },
                { id: "dessert_lover", title: "ãƒ‡ã‚¶ãƒ¼ãƒˆã¯åˆ¥è…¹", sub: "ãƒ‡ã‚¶ãƒ¼ãƒˆã‚’åˆè¨ˆ3å›å¼•ã", icon: "ğŸ°" },
                { id: "vegetarian", title: "ãƒ™ã‚¸ã‚¿ãƒªã‚¢ãƒ³", sub: "ã‚µãƒ©ãƒ€ã‚’åˆè¨ˆ3å›å¼•ã", icon: "ğŸ¥—" },
                { id: "senbero", title: "ã›ã‚“ã¹ã‚", sub: "100å††ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å¼•ã", icon: "ğŸ’¸" },
                { id: "junkie", title: "ã‚¬ãƒãƒ£ã‚¸ãƒ£ãƒ³ã‚­ãƒ¼", sub: "åˆè¨ˆ30å›ã‚¹ãƒ”ãƒ³ã™ã‚‹", icon: "ğŸ°" },
                { id: "dupe", title: "ã“ã®æµã‚Œã‚’æ­¢ã‚ã¦", sub: "æŒã£ã¦ã„ã‚‹ã‚‚ã®ã‚’10é€£ç¶šã§å¼•ã„ãŸ", icon: "â™»ï¸" },
                { id: "spins_10", title: "åˆè¨ˆ10å›å¼•ã", sub: "æš‡ã‹ã‚ˆ", icon: "â±ï¸" }
            ];

            trophies.forEach(t => {
                if (isMinor && t.hiddenIfMinor) return;

                const isUnlocked = state.unlockedTrophies.includes(t.id);
                const el = document.createElement('div');
                el.className = `p-4 rounded-2xl flex items-center space-x-4 trophy-card ${isUnlocked ? 'trophy-unlocked shadow-md' : 'opacity-40 grayscale'}`;
                el.innerHTML = `
                    <div class="text-3xl">${isUnlocked ? t.icon : 'ğŸ”’'}</div>
                    <div class="text-left">
                        <div class="font-bold text-gray-800 ${isUnlocked && t.isRainbow ? 'rainbow-text' : ''}">${t.title}</div>
                        <div class="text-xs text-gray-500">${t.sub}</div>
                    </div>
                `;
                list.appendChild(el);
            });
        }

        spinBtn.addEventListener('click', spin);
        document.getElementById('open-collection').addEventListener('click', () => {
            updateTabs('menu');
            document.getElementById('collection-modal').style.display = 'flex';
        });
        document.getElementById('tab-menu').addEventListener('click', () => updateTabs('menu'));
        document.getElementById('tab-trophy').addEventListener('click', () => updateTabs('trophy'));
        document.getElementById('close-modal').addEventListener('click', () => document.getElementById('collection-modal').style.display = 'none');
    </script>
</body>
</html>
